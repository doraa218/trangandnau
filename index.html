<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Valentine Surprise</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
  body {
    margin: 0;
    font-family: 'Press Start 2P', cursive;
    background: linear-gradient(135deg, #ff9a9e, #fad0c4);
    overflow: hidden;
    height: 100vh;
  }

  .heart {
    position: absolute;
    color: #ff4b6e;
    font-size: 20px;
    user-select: none;
    pointer-events: none;
    animation: fall linear forwards;
    z-index: 0;
  }

  @keyframes fall {
    to { transform: translateY(100vh) rotate(360deg); opacity: 0; }
  }

  .page {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    display: none;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    text-align: center;
    padding: 20px;
    box-sizing: border-box;
    z-index: 10;
  }

  .page.active { display: flex; animation: fade 0.6s ease; }

  @keyframes fade {
    from { opacity: 0; transform: scale(0.98); }
    to { opacity: 1; transform: scale(1); }
  }

  button {
    padding: 12px 24px;
    border: none;
    border-radius: 25px;
    background: #ff4b6e;
    color: white;
    font-family: 'Press Start 2P', cursive;
    font-size: 14px;
    cursor: pointer;
    margin-top: 20px;
    transition: 0.3s;
  }

  .hub {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
    margin-top: 20px;
  }

  .gift {
    font-size: 60px;
    cursor: pointer;
    transition: 0.3s;
    background: rgba(255,255,255,0.3);
    padding: 15px;
    border-radius: 15px;
  }

  #music {
    background: url('https://wallpaperaccess.com/full/2641043.gif') center/cover no-repeat;
  }

  .music-container {
    background: rgba(0, 0, 0, 0.5);
    padding: 25px;
    border-radius: 20px;
    display: flex;
    align-items: flex-start;
    gap: 30px;
    max-width: 850px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.1);
  }

  .left-col {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
  }

  .vinyl-wrapper {
    position: relative;
    width: 180px;
    height: 180px;
    border-radius: 50%;
    overflow: hidden;
  }

  .vinyl {
    width: 100%;
    height: 100%;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .vinyl img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: 1;
  }

  .vinyl::after {
    content: "";
    position: absolute;
    width: 40px;
    height: 40px;
    background: #111;
    border-radius: 50%;
    z-index: 2;
    border: 3px solid #333;
  }

  .rotating { animation: spin 4s linear infinite; }
  @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

  .now-playing-bar {
    background: rgba(255, 255, 255, 0.15);
    border-radius: 12px;
    padding: 10px 15px;
    display: flex;
    align-items: center;
    gap: 12px;
    width: 280px;
    color: white;
  }

  .now-playing-bar img { width: 45px; height: 45px; border-radius: 5px; }

 .song-info-mini { 
    text-align: left; 
    flex-grow: 1; 
    font-family: 'Times New Roman', Times, serif; 
    color: white;
}
.song-info-mini #displayTitle { font-size: 14px; font-weight: bold; margin-bottom: 2px; }
.song-info-mini #displayArtist { font-size: 11px; opacity: 0.8; }

  .playlist {
    text-align: left;
    background: #8e2b2b;
    border-radius: 15px;
    width: 380px;
    color: white;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  .song-item {
    font-size: 13px;
    padding: 10px 20px;
    cursor: pointer;
    transition: 0.2s;
    border-bottom: 1px solid rgba(255,255,255,0.05);
  }

  .song-item:hover { background: rgba(255,255,255,0.1); }

  /* X√≥a b·ªè ch·∫ø ƒë·ªô chia l∆∞·ªõi c≈©, thay b·∫±ng khung ch·ª©a ·∫£nh ƒë∆°n */
.gallery {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 95%; /* Chi·∫øm g·∫ßn h·∫øt chi·ªÅu r·ªông m√†n h√¨nh */
    max-width: 600px;
    margin: 0 auto;
}

.gallery img {
    width: 100%;
    height: auto; /* Gi·ªØ ƒë√∫ng t·ª∑ l·ªá ·∫£nh b·∫°n thi·∫øt k·∫ø */
    border-radius: 15px; /* Bo g√≥c cho m·ªÅm m·∫°i */
    border: 5px solid white; /* T·∫°o vi·ªÅn nh∆∞ khung ·∫£nh th·∫≠t */
    box-shadow: 0 10px 30px rgba(0,0,0,0.3); /* ƒê·ªï b√≥ng cho ·∫£nh n·ªïi l√™n */
}
/* Hi·ªáu ·ª©ng c√°nh hoa r∆°i */
.sakura {
    position: absolute;
    background-color: #ffb7c5; /* M√†u h·ªìng hoa anh ƒë√†o */
    border-radius: 100% 0 100% 0; /* T·∫°o h√¨nh c√°nh hoa */
    opacity: 0.7;
    pointer-events: none;
    z-index: 5;
    animation: sakura-fall linear forwards;
}

@keyframes sakura-fall {
    0% { transform: translateY(-10vh) translateX(0) rotate(0deg); opacity: 1; }
    100% { transform: translateY(100vh) translateX(100px) rotate(360deg); opacity: 0; }
}
#letter .page {
    overflow-y: auto; /* N·∫øu th∆∞ d√†i qu√° s·∫Ω c√≥ thanh cu·ªôn */
    padding-bottom: 50px;
}
/* Hi·ªáu ·ª©ng n·∫£y l√™n */
@keyframes bounceIn {
    0% { transform: scale(0.3); opacity: 0; }
    50% { transform: scale(1.1); }
    70% { transform: scale(0.9); }
    100% { transform: scale(1); opacity: 1; }
}

/* --- PH·∫¶N H·ªòP QU√Ä CHU·∫®N --- */
.surprise-box {
    width: 100px;
    height: 100px;
    cursor: pointer;
    /* S·ª≠ d·ª•ng h√¨nh ·∫£nh h·ªôp socola l√†m n·ªÅn */
    background-image: url('hopquaxoanen.png'); 
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    background-color: transparent !important; /* X√≥a n·ªÅn tr·∫Øng c≈© */
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 0 auto;
    transition: all 0.3s ease;
    box-shadow: none !important; /* X√≥a b√≥ng ƒë·ªï c·ªßa khung tr·∫Øng c≈© */
    border: none !important;
}

/* Hi·ªáu ·ª©ng n·∫£y m·∫°nh khi di chu·ªôt v√†o h·ªôp qu√† */
@keyframes heartBounce {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.2) translateY(-15px); }
}

.surprise-box:hover {
    animation: heartBounce 0.6s ease-in-out infinite !important;
    filter: drop-shadow(0 10px 15px rgba(255, 75, 110, 0.4)); /* T·∫°o b√≥ng ƒë·ªï quanh h√¨nh h·ªôp qu√† */
}
∆∞.firework-particle {
    position: absolute;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    pointer-events: none;
    z-index: 999;
    animation: explode 1s ease-out forwards;
}

@keyframes explode {
    0% { transform: translate(0, 0) scale(1); opacity: 1; }
    100% { transform: translate(var(--dx), var(--dy)) scale(0); opacity: 0; }
}
/* Khung ch·ª©a c√°c m·∫£nh gh√©p */
.puzzle-container {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    grid-template-rows: repeat(4, 1fr);
    width: 90vw; /* Chi·∫øm 90% chi·ªÅu ngang m√†n h√¨nh ƒëi·ªán tho·∫°i */
    max-width: 500px; /* Kh√¥ng qu√° to tr√™n m√°y t√≠nh */
    aspect-ratio: 4 / 3; /* Ch·ªânh th√†nh 3/4 n·∫øu ·∫£nh c·ªßa b·∫°n l√† ·∫£nh d·ªçc */
    margin: 20px auto;
    position: relative;
    border: 8px solid white;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    background-color: rgba(255,255,255,0.2);
}

.puzzle-piece {
    width: 100.5%; /* TƒÉng nh·∫π ƒë·ªÉ che kh√≠t c√°c khe h·ªü gi·ªØa m·∫£nh gh√©p */
    height: 100.5%;
    background-image: url('gallery.png'); 
    background-size: 400% 400%;
    transition: all 1.5s cubic-bezier(0.19, 1, 0.22, 1);
}
/* L√†m ƒë·∫πp thanh cu·ªôn cho ph·∫ßn th∆∞ */
#letter div::-webkit-scrollbar {
    width: 6px;
}
#letter div::-webkit-scrollbar-track {
    background: transparent;
}
#letter div::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.4);
    border-radius: 10px;
}
/* --- CSS CHO GAME L·∫¨T TH·∫∫ --- */
.memory-game { 
    display: grid; 
    grid-template-columns: repeat(4, 1fr); 
    gap: 8px; 
    width: 95%; 
    max-width: 400px; 
    margin: 15px auto; 
}
.memory-card { 
    aspect-ratio: 1/1; 
    position: relative; 
    transform-style: preserve-3d; 
    transition: transform 0.5s; 
    cursor: pointer; 
}
.memory-card.flip { transform: rotateY(180deg); }
.card-front, .card-back { 
    position: absolute; 
    width: 100%; 
    height: 100%; 
    backface-visibility: hidden; 
    border-radius: 8px; 
    border: 2px solid white; 
}
.card-front { 
    background-size: cover; 
    background-position: center; 
    transform: rotateY(180deg); 
}
.card-back { 
    background-color: #ff4b6e; 
    background-image: url('hopquaxoanen.png'); /* D√πng ƒë√∫ng file h·ªôp qu√† b·∫°n ƒë√£ c√≥ */
    background-size: 60%; 
    background-repeat: no-repeat; 
    background-position: center; 
}
/* Hi·ªáu ·ª©ng khi l·∫≠t ƒë√∫ng c·∫∑p */
.memory-card.matched {
    animation: matchSuccess 0.5s ease-in-out;
    border: 3px solid #2ecc71 !important;
    box-shadow: 0 0 20px #2ecc71;
}

@keyframes matchSuccess {
    0%, 100% { transform: scale(1) rotateY(180deg); }
    50% { transform: scale(1.1) rotateY(180deg); }
}

/* Hi·ªáu ·ª©ng khi th·∫Øng t·∫•t c·∫£ */
.game-win-overlay {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(255, 255, 255, 0.9);
    padding: 20px;
    border-radius: 20px;
    color: #ff4b6e;
    z-index: 100;
    display: none;
    box-shadow: 0 0 50px white;
    width: 80%;
}
/* L·ªõp ch·ªØ ·∫©n sau khung game */
.game-win-message {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 40px; /* L√†m ch·ªØ to h∆°n cho ·∫•n t∆∞·ª£ng */
    color: white;
    text-shadow: 0 0 15px #ff4b6e, 0 0 30px #ff4b6e;
    opacity: 0;
    transition: opacity 2s ease; /* Ch·ªØ hi·ªán l√™n t·ª´ t·ª´ trong 2 gi√¢y */
    pointer-events: none;
    z-index: 5;
    white-space: nowrap;
    font-weight: bold;
}

/* Hi·ªáu ·ª©ng nh√≤e v√† bi·∫øn m·∫•t cho c√°c th·∫ª */
.memory-game.game-over .memory-card {
    filter: blur(15px); /* Nh√≤e m·∫°nh h∆°n */
    opacity: 0;
    transform: scale(0.3) rotate(20deg); /* Thu nh·ªè v√† xoay nh·∫π khi bi·∫øn m·∫•t */
    transition: all 2s ease;
    pointer-events: none;
}
</style>
</head>
<body>

<div class="page active" id="page1">
  <h1>Happy Valentine's Day üíñ</h1>
  <p>A little journey of surprises is waiting for you...</p>
  <button onclick="showPage('hub')">START</button>
</div>

<div class="page" id="hub">
  <h2 style="color:white; text-shadow: 2px 2px 0px #ff4b6e; margin-top: 40px;">Choose a present üíù</h2>
  
  <div class="hub" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 30px; padding: 20px; max-width: 350px; margin: 0 auto;">
    <div class="surprise-box" onclick="showPage('music')"></div>
    <div class="surprise-box" onclick="showPage('gallery1')"></div>
    <div class="surprise-box" onclick="showPage('message')"></div>
    <div class="surprise-box" onclick="showPage('letter')"></div>
  </div>

  <button onclick="showPage('page1')" style="margin-top: 30px; position: relative; z-index: 10;">‚¨Ö Back</button>
</div>
<div class="page" id="music">
  <h2 style="color:white; text-shadow: 2px 2px 0px #ff4b6e; font-size: 20px; margin-bottom: 5px;">A SONG/PLAYLIST FOR YOU</h2>
  <p style="color:white; font-size: 18px; margin-bottom: 25px; font-family: sans-serif;">Press play - this melody carries a little piece of my heart</p>

  <div class="music-container">
    <div class="left-col">
      <div class="vinyl-wrapper" id="vinylDisk">
        <div class="vinyl">
          <img src="1000101679.png" id="currentCover">
        </div>
      </div>
      <div class="now-playing-bar">
        <img src="1000101682.jpg" id="miniCover">
        <div class="song-info-mini">
          <div id="displayTitle">Valentine</div>
          <div id="displayArtist">Laufey</div>
        </div>
        <div style="cursor: pointer; color: white; font-size: 22px; font-weight: bold;" onclick="togglePlay()">||</div>
      </div>
    </div>

   <div class="playlist" style="background: #8e2b2b; padding: 0; overflow: hidden; display: flex; flex-direction: column;">
  <div style="padding: 20px; display: flex; align-items: flex-end; gap: 15px; background: linear-gradient(transparent, rgba(0,0,0,0.5));">
    <img src="1000101680.jpg" id="playlistCover" style="width: 100px; height: 100px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); border-radius: 4px;">
    <div style="text-align: left; color: white;">
      <div style="font-size: 9px; text-transform: uppercase; letter-spacing: 1px;">Playlist</div>
      <div style="font-size: 20px; font-weight: bold; margin: 5px 0; line-height: 1.2;">Valentine's Day\love songs</div>
      <div style="font-size: 10px; opacity: 0.8;">Save on Spotify ‚Ä¢ 3 songs</div>
    </div>
  </div>

  <div style="padding: 15px; font-family: 'Times New Roman', Times, serif; flex-grow: 1;">
    <div class="song-item" onclick="playMusic('valentine.mp3', 'Valentine', 'Laufey')">
      1. <b>Valentine</b> - Laufey <span style="float:right">02:48</span>
    </div>
    <div class="song-item" onclick="playMusic('vanvat.mp3', 'V·∫°n v·∫≠t nh∆∞ mu·ªën ta b√™n nhau', 'RIO')">
      2. <b>V·∫°n v·∫≠t nh∆∞ mu·ªën ta b√™n nhau</b> - RIO <span style="float:right">03:15</span>
    </div>
    <div class="song-item" onclick="playMusic('angel.mp3', 'Angel Baby', 'Troye Sivan')">
      3. <b>Angel Baby</b> - Troye Sivan <span style="float:right">03:40</span>
    </div>
  </div>
  
  <audio id="mainAudio"></audio>
</div> </div> <button onclick="showPage('hub')" style="margin-top: 25px; position: relative; z-index: 20;">‚¨Ö Back</button>

</div>

<div class="page" id="gallery1">
    <h2 style="color:white; text-shadow: 2px 2px 0px #ff4b6e; font-size: 20px; margin-bottom: 20px;">Our photo üì∏</h2>
    
    <div class="puzzle-container" id="puzzleBoard"></div>

    <button onclick="showPage('hub')" style="margin-top: 30px; position: relative; z-index: 100;">‚¨Ö Back</button>
</div>

<div class="page" id="message">
    <h2 style="color:white; text-shadow: 2px 2px 0px #ff4b6e;">Just For You üíù</h2>
    <p style="color:white; font-size: 12px; margin-bottom: 10px;">Find 8 pairs of memories!</p>
    
    <div style="position: relative; width: 100%; max-width: 400px; margin: 0 auto;">
        <div class="memory-game" id="gameBoard"></div>
        <div id="winMessage" class="game-win-message">I LOVE YOU ‚ù§Ô∏è</div>
    </div>

    <button onclick="showPage('hub')">‚¨Ö Back</button>
</div>
<div class="page" id="letter">
  <h2 style="color:white; text-shadow: 2px 2px 0px #ff4b6e; font-size: 18px; margin-bottom: 10px;">A Letter From My Heart üíå</h2>
  
  <div style="background: rgba(255, 255, 255, 0.2); 
              backdrop-filter: blur(10px); 
              -webkit-backdrop-filter: blur(10px);
              width: 95%; 
              max-width: 650px; /* TƒÉng chi·ªÅu ngang t·ª´ 500px l√™n 650px */
              height: 60vh;    /* S·ª≠ d·ª•ng vh ƒë·ªÉ t·ª± co gi√£n theo chi·ªÅu cao m√†n h√¨nh */
              max-height: 400px; 
              padding: 20px; 
              margin: 0 auto; 
              border-radius: 15px; 
              border: 1px solid rgba(255, 255, 255, 0.3);
              box-shadow: 0 10px 30px rgba(0,0,0,0.15); 
              text-align: left; 
              color: white; 
              font-family: 'Times New Roman', Times, serif; 
              box-sizing: border-box;
              display: flex;
              flex-direction: column;">

    <div style="overflow-y: auto; 
                flex-grow: 1; 
                padding-right: 15px;
                scrollbar-width: thin; 
                scrollbar-color: rgba(255,255,255,0.5) transparent;">
      
      <div style="white-space: pre-line; 
                  line-height: 1.6; 
                  font-size: 16px; 
                  text-shadow: 1px 1px 2px rgba(0,0,0,0.2);">Ch√†o HAnh iu c·ªßa em 
Happy Valentine‚Äôs Day & our 11-month anniversary!

C·∫£m ∆°n qu√† valentine c·ªßa c·ªßa c, em th√≠ch l·∫Øm hii 
C·∫£m ∆°n HAnh v·∫´n lu√¥n y√™u th∆∞∆°ng, quan t√¢m v√† ·ªü b√™n c·∫°nh em. 

H√¥m tr∆∞·ªõc HAnh d·ªói emm, em bu·ªìn l·∫Øm, l√† l·ªói c·ªßa em n√™n em s·∫Ω r√∫t kinh nghi·ªámm. Mong r·∫±ng em s·∫Ω kh√¥ng l√†m phi·ªÅn l√≤ng HAnh n·ªØa. Hi v·ªçng c√¢u chuy·ªán c·ªßa ch√∫ng m√¨nh s·∫Ω lu√¥n l√† c√¢u chuy·ªán ƒë·∫πp üçì

HAnh c·ªßa em ƒÉn u·ªëng ƒë·∫ßy ƒë·ªß v√†o ƒë·ªÉ c√≤n c√≥ s·ª©c l√†m vi·ªác üòæ Em c≈©ng s·∫Ω c·ªë g·∫Øng ƒÉn ƒë√∫ng gi·ªù ƒë√∫ng b·ªØa h∆°n ·∫°. 

Mong r·∫±ng ch√∫ng m√¨nh s·∫Ω lu√¥n vui, h·∫πn HAnh 1 v√†i ng√†y n·ªØa nhee üòô
See u soon!! 

m·∫±l u·∫øihn n·∫°d u√™y iut ‚ù§Ô∏è</div>
    </div>
  </div>

  <div style="display: flex; gap: 15px; margin-top: 15px; justify-content: center;">
    <button onclick="showPage('hub')" style="background: rgba(255,255,255,0.2); border: 1px solid white; padding: 10px 20px;">‚¨Ö Back</button>
    <button onclick="showPage('ending')" style="padding: 10px 20px;">Finish üíñ</button>
  </div>
</div>
  <div class="page" id="ending">
  <h1 style="color:white; text-shadow: 3px 3px 0px #ff4b6e; font-size: 24px;">Thank You For This Journey üíû</h1>
  <div style="font-size: 50px; margin: 20px 0;">üíë</div>
  <p style="color:white; font-size: 14px; line-height: 1.8;">You are my favorite person,<br>today and always.</p>
  
  <div style="display:flex; gap:10px; justify-content: center;">
      <button onclick="showPage('hub')">‚¨Ö Menu</button>
      <button onclick="showPage('page1')">Replay ‚Üª</button>
  </div>
</div>
<script>
  // H√ÄM CHUY·ªÇN TRANG
 // H√ÄM CHUY·ªÇN TRANG
  function showPage(id) {
    // 1. ·∫®n t·∫•t c·∫£ c√°c trang
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    
    // 2. Hi·ªán trang m·ª•c ti√™u
    const target = document.getElementById(id);
    if (target) {
      target.classList.add('active');

      // 3. Logic cho Hub
      if (id === 'hub') {
        const boxes = target.querySelectorAll('.surprise-box');
        boxes.forEach((box) => {
          box.style.animation = 'none';
        });
      }

      // 4. HI·ªÜU ·ª®NG GH√âP ·∫¢NH (ƒê√É FIX KH·ªöP H√åNH)
     if (id === 'gallery1') {
        const board = document.getElementById('puzzleBoard');
        board.innerHTML = ''; 
        
        for (let i = 0; i < 16; i++) {
          const piece = document.createElement('div');
          piece.className = 'puzzle-piece';
          
          // C√¥ng th·ª©c chu·∫©n cho l∆∞·ªõi 4x4 ƒë·ªÉ kh√¥ng l·ªách form
          const x = (i % 4) * 33.333; 
          const y = Math.floor(i / 4) * 33.333;
          piece.style.backgroundPosition = `${x}% ${y}%`;

          const randomX = (Math.random() - 0.5) * 2000;
          const randomY = (Math.random() - 0.5) * 2000;
          const randomRotation = (Math.random() - 0.5) * 1080;
          
          piece.style.transform = `translate(${randomX}px, ${randomY}px) rotate(${randomRotation}deg) scale(0)`;
          piece.style.opacity = '0';

          board.appendChild(piece);

          setTimeout(() => {
            piece.style.transform = 'translate(0, 0) rotate(0deg) scale(1)';
            piece.style.opacity = '1';
          }, 150 + (i * 45)); 
        }
      }
// --- LOGIC CHO TR√í CH∆†I L·∫¨T TH·∫∫ ---
   if (id === 'message') {
      const gameBoard = document.getElementById('gameBoard');
      if (gameBoard) {
        gameBoard.innerHTML = '';
        const images = ['anh1.jpg', 'anh2.jpeg', 'anh3.jpg', 'anh4.jpg', 'anh5.jpg', 'anh6.jpg', 'anh7.jpg', 'anh8.jpg'];
        const cardsData = [...images, ...images].sort(() => Math.random() - 0.5);
        
        let hasFlipped = false, lock = false, first, second;
        let matchedPairs = 0; // Bi·∫øn ƒë·∫øm s·ªë c·∫∑p ƒë√∫ng

        cardsData.forEach(img => {
          const card = document.createElement('div');
          card.className = 'memory-card';
          card.dataset.img = img;
          card.innerHTML = `<div class="card-front" style="background-image: url('${img}')"></div><div class="card-back"></div>`;
          
          card.onclick = function() {
            if (lock || this === first || this.classList.contains('matched')) return;
            this.classList.add('flip');
            if (!hasFlipped) { hasFlipped = true; first = this; return; }
            second = this; lock = true;
            
            if (first.dataset.img === second.dataset.img) {
              // L·∫¨T ƒê√öNG C·∫∂P
              first.classList.add('matched');
              second.classList.add('matched');
              matchedPairs++;
              
              // Ch√∫c m·ª´ng nh·ªè khi ƒë√∫ng 1 c·∫∑p
              if (typeof launchFireworks === "function") {
                  setTimeout(launchFireworks, 200); 
              }

              // KI·ªÇM TRA TH·∫ÆNG TO√ÄN B·ªò
              if (matchedPairs === 8) {
                setTimeout(() => {
                  // 1. Th√™m class l√†m nh√≤e v√† bi·∫øn m·∫•t c√°c th·∫ª ·∫£nh
                  gameBoard.classList.add('game-over');
                  
                  // 2. Hi·ªán d√≤ng ch·ªØ I LOVE YOU t·ª´ d∆∞·ªõi l·ªõp ·∫£nh
                  const winMsg = document.getElementById('winMessage');
                  if(winMsg) winMsg.style.opacity = '1';

                  // 3. B·∫Øn ph√°o hoa ƒÉn m·ª´ng l·ªõn (15 ƒë·ª£t li√™n t·ª•c)
                  for(let i = 0; i < 15; i++) {
                    setTimeout(launchFireworks, i * 300);
                  }
                }, 1000); 
              }

              resetBoard();
            } else {
              // L·∫¨T SAI
              setTimeout(() => { 
                first.classList.remove('flip'); 
                second.classList.remove('flip'); 
                resetBoard(); 
              }, 1000);
            }
          };
          gameBoard.appendChild(card);
        });

        function resetBoard() {
          [hasFlipped, lock] = [false, false];
          [first, second] = [null, null];
        }
      }
    }

      // 5. B·∫Øn ph√°o hoa
      if (id === 'ending') {
        for(let i=0; i<5; i++) {
          setTimeout(launchFireworks, i * 400);
        }
      }
    }
  }
  // H√ÄM T·∫†O PH√ÅO HOA
  function launchFireworks() {
    const startX = Math.random() * 80 + 10;
    const startY = Math.random() * 40 + 30;
    for (let i = 0; i < 60; i++) {
      const particle = document.createElement('div');
      particle.classList.add('firework-particle');
      const colors = ['#ff4b6e', '#ff9a9e', '#ffffff', '#ffff00', '#00ffff'];
      particle.style.background = colors[Math.floor(Math.random() * colors.length)];
      particle.style.left = startX + 'vw';
      particle.style.top = startY + 'vh';
      const angle = Math.random() * Math.PI * 2;
      const velocity = Math.random() * 180 + 80;
      particle.style.setProperty('--dx', `${Math.cos(angle) * velocity}px`);
      particle.style.setProperty('--dy', `${Math.sin(angle) * velocity}px`);
      document.body.appendChild(particle);
      setTimeout(() => particle.remove(), 1200);
    }
  }

  // C√ÅC HI·ªÜU ·ª®NG R∆†I (TR√ÅI TIM & HOA ANH ƒê√ÄO)
  function createHeart() {
    const heart = document.createElement('div');
    heart.classList.add('heart');
    heart.innerHTML = '‚ù§Ô∏è';
    heart.style.left = Math.random() * 100 + 'vw';
    heart.style.animationDuration = (Math.random() * 3 + 2) + 's';
    heart.style.fontSize = (Math.random() * 10 + 15) + 'px';
    document.body.appendChild(heart);
    setTimeout(() => heart.remove(), 5000);
  }
  setInterval(createHeart, 300);

  function createSakura() {
    if (!document.getElementById('gallery1').classList.contains('active')) return;
    const sakura = document.createElement('div');
    sakura.classList.add('sakura');
    const size = Math.random() * 10 + 5 + 'px';
    sakura.style.width = size; sakura.style.height = size;
    sakura.style.left = Math.random() * 100 + 'vw';
    sakura.style.animationDuration = Math.random() * 3 + 4 + 's';
    document.body.appendChild(sakura);
    setTimeout(() => sakura.remove(), 6000);
  }
  setInterval(createSakura, 200);

  // PH·∫¶N NH·∫†C
  const audio = document.getElementById('mainAudio');
  const vinylDisk = document.getElementById('vinylDisk');

  function togglePlay() {
    if (!audio.src) return alert("Select a song first!");
    if (audio.paused) {
      audio.play();
      vinylDisk.classList.add('rotating');
    } else {
      audio.pause();
      vinylDisk.classList.remove('rotating');
    }
  }

  function playMusic(link, title, artist) {
    audio.src = link;
    audio.play();
    vinylDisk.classList.add('rotating');
    document.getElementById('displayTitle').innerHTML = "<b>" + title + "</b>";
    document.getElementById('displayArtist').innerText = artist;
  }
</script>

</body>
</html>
